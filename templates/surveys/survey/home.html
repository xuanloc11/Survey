{% extends 'base.html' %}

{% block title %}Khám phá khảo sát công khai{% endblock %}

{% block content %}
<div class="hero-section">
    <h1 class="mb-3">Khám phá và tham gia khảo sát</h1>
    <p class="lead mb-3">Đây là trang khảo sát sau khi người dùng rời landing page. Hãy tìm khảo sát phù hợp và tham gia ngay.</p>
    <a href="{% url 'surveys:survey_create' %}" class="btn btn-primary btn-lg me-2">
        <i class="bi bi-plus-circle"></i> Tạo khảo sát mới
    </a>
    {% if not user.is_authenticated %}
    <a href="{% url 'surveys:login' %}" class="btn btn-outline-light btn-lg">
        <i class="bi bi-box-arrow-in-right"></i> Đăng nhập
    </a>
    {% endif %}
</div>

<!-- Search + list wrapper -->
<div class="row">
    <div class="col-lg-4 mb-4">
        <div class="card home-search-card h-100">
            <div class="card-body">
                <h5 class="card-title mb-3"><i class="bi bi-search"></i> Tìm kiếm khảo sát</h5>
                <form method="get" action="{% url 'surveys:survey_explore' %}">
                    <div class="mb-3">
                        <input type="text" class="form-control" name="search" 
                               placeholder="Nhập tên hoặc mô tả khảo sát..." value="{{ search_query }}">
                    </div>
                    <button class="btn btn-primary w-100" type="submit">Tìm kiếm</button>
                </form>
                {% if search_query %}
                <p class="mt-3 small text-muted">
                    Kết quả cho từ khóa: "<strong>{{ search_query }}</strong>"
                </p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-lg-8">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="mb-0">
                <i class="bi bi-list-check"></i> Khảo sát đang hoạt động
                <span class="badge bg-primary">{{ surveys.count }}</span>
            </h4>
        </div>

        {% if user.is_authenticated and recent_user_surveys %}
        <div class="mb-3">
            <p class="small text-muted mb-1"><i class="bi bi-clock-history"></i> Hoạt động gần đây của bạn</p>
            <div class="survey-grid mb-3">
                {% for survey in recent_user_surveys %}
                <div class="survey-card">
                    <div class="survey-card-header">
                        <div>
                            <h5 class="survey-title">{{ survey.title }}</h5>
                            <p class="survey-desc text-muted mb-1">{{ survey.description|default:"Không có mô tả" |truncatewords:14 }}</p>
                        </div>
                        <span class="badge bg-light text-primary border"><i class="bi bi-person-badge"></i> Của bạn</span>
                    </div>
                    <div class="survey-card-meta">
                        <span><i class="bi bi-calendar"></i> {{ survey.created_at|date:"d/m/Y" }}</span>
                        <span><i class="bi bi-chat-dots"></i> {{ survey.response_count }} phản hồi</span>
                    </div>
                    <div class="survey-card-actions">
                        <a href="{% url 'surveys:survey_detail' survey.pk %}" class="btn btn-sm btn-primary">
                            <i class="bi bi-eye"></i> Mở builder
                        </a>
                        <a href="{% url 'surveys:survey_results' survey.pk %}" class="btn btn-sm btn-outline-success">
                            <i class="bi bi-graph-up"></i> Kết quả
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if surveys %}
        <div class="survey-grid">
            {% for survey in surveys %}
            <div class="survey-card">
                <div class="survey-card-header">
                    <div>
                        <h5 class="survey-title">{{ survey.title }}</h5>
                        <p class="survey-desc text-muted mb-1">{{ survey.description|default:"Không có mô tả" |truncatewords:18 }}</p>
                    </div>
                    {% if user.is_authenticated and survey.creator == user %}
                    <span class="badge bg-light text-primary border"><i class="bi bi-person-badge"></i> Của bạn</span>
                    {% endif %}
                </div>
                <div class="survey-card-meta">
                    <span><i class="bi bi-person"></i> {{ survey.creator.username }}</span>
                    <span><i class="bi bi-calendar"></i> {{ survey.created_at|date:"d/m/Y" }}</span>
                    <span><i class="bi bi-chat-dots"></i> {{ survey.response_count }} phản hồi</span>
                    {% if survey.expires_at %}
                    <span class="badge bg-warning-subtle text-warning border">
                        <i class="bi bi-clock"></i> {{ survey.expires_at|date:"d/m/Y H:i" }}
                    </span>
                    {% endif %}
                </div>
                <div class="survey-card-actions">
                    <a href="{% url 'surveys:survey_detail' survey.pk %}" class="btn btn-sm btn-primary">
                        <i class="bi bi-eye"></i> Xem / tham gia
                    </a>
                    {% if user.is_authenticated and survey.creator == user %}
                    <a href="{% url 'surveys:survey_edit' survey.pk %}" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-pencil-square"></i> Chỉnh sửa
                    </a>
                    <a href="{% url 'surveys:survey_results' survey.pk %}" class="btn btn-sm btn-outline-success">
                        <i class="bi bi-graph-up"></i> Kết quả
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> 
            {% if search_query %}
            Không tìm thấy khảo sát nào phù hợp với từ khóa "<strong>{{ search_query }}</strong>".
            {% else %}
            Chưa có khảo sát nào. Hãy bắt đầu bằng cách tạo khảo sát đầu tiên của bạn!
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

