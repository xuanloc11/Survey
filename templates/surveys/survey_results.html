{% extends 'base.html' %}

{% block title %}Kết quả: {{ survey.title }}{% endblock %}

{% block content %}
<div class="card mb-4">
    <div class="card-header">
        <h3 class="mb-0">
            <i class="bi bi-graph-up"></i> Kết quả khảo sát
        </h3>
    </div>
    <div class="card-body">
        <h4>{{ survey.title }}</h4>
        <div class="row text-center mt-4">
            <div class="col-md-4">
                <div class="stat-card">
                    <div class="stat-number">{{ total_responses }}</div>
                    <small class="text-muted">Tổng số phản hồi</small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card">
                    <div class="stat-number">{{ survey.questions.count }}</div>
                    <small class="text-muted">Số câu hỏi</small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card">
                    <div class="stat-number">{{ survey.responses.count }}</div>
                    <small class="text-muted">Người tham gia</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Statistics -->
{% for stat in stats %}
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">
            Câu {{ forloop.counter }}: {{ stat.question.text }}
            <span class="badge bg-secondary">{{ stat.question.get_question_type_display }}</span>
        </h5>
    </div>
    <div class="card-body">
        {% if stat.type == 'text' %}
        <p class="text-muted">Tổng số câu trả lời: {{ stat.total }}</p>
        <div class="list-group">
            {% for answer in stat.answers %}
            <div class="list-group-item">
                <div class="d-flex align-items-start">
                    <span class="badge bg-primary me-2">{{ forloop.counter }}</span>
                    <div class="flex-grow-1">{{ answer.text_answer }}</div>
                </div>
            </div>
            {% empty %}
            <div class="alert alert-info">Chưa có câu trả lời nào</div>
            {% endfor %}
        </div>
        {% if stat.total > 10 %}
        <p class="text-muted mt-2">
            <small>Hiển thị 10 câu trả lời đầu tiên trong tổng số {{ stat.total }} câu trả lời</small>
        </p>
        {% endif %}
        
        {% else %}
        <p class="text-muted mb-3">Tổng số phản hồi: {{ stat.total }}</p>
        {% for choice_stat in stat.choices %}
        <div class="mb-3">
            <div class="d-flex justify-content-between mb-1">
                <span>{{ choice_stat.choice.text }}</span>
                <span class="fw-bold">{{ choice_stat.count }} ({{ choice_stat.percentage }}%)</span>
            </div>
            <div class="progress">
                <div class="progress-bar" role="progressbar" 
                     style="width: {{ choice_stat.percentage }}%"
                     aria-valuenow="{{ choice_stat.percentage }}" 
                     aria-valuemin="0" 
                     aria-valuemax="100">
                    {{ choice_stat.percentage }}%
                </div>
            </div>
        </div>
        {% endfor %}
        {% endif %}
    </div>
</div>
{% endfor %}

<div class="text-center mt-4">
    <a href="{% url 'surveys:survey_detail' survey.pk %}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Quay lại
    </a>
    <a href="{% url 'surveys:survey_list' %}" class="btn btn-primary">
        <i class="bi bi-list"></i> Danh sách khảo sát
    </a>
</div>
{% endblock %}

